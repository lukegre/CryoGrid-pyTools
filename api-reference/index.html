<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>API Reference - CryoGrid-pyTools</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../stylesheets/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API Reference";
        var mkdocs_page_input_path = "api-reference.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CryoGrid-pyTools
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../usage/getting-started/">Getting Started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../usage/reading-output/">Reading CryoGrid Output</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../usage/reading-matlab/">Reading MATLAB Structs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../usage/spatial-data/">Spatial Data and Forcing</a>
                  </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">API Reference</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#main-functions">Main Functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cryogrid_pytools.read_OUT_regridded_FCI2_file">read_OUT_regridded_FCI2_file</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.read_OUT_regridded_FCI2_file--parameters">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.read_OUT_regridded_FCI2_file--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cryogrid_pytools.read_OUT_regridded_FCI2_clusters">read_OUT_regridded_FCI2_clusters</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.read_OUT_regridded_FCI2_clusters--parameters">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.read_OUT_regridded_FCI2_clusters--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cryogrid_pytools.matlab_helpers.read_mat_struct_flat_as_dict">read_mat_struct_flat_as_dict</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.matlab_helpers.read_mat_struct_flat_as_dict--parameters">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.matlab_helpers.read_mat_struct_flat_as_dict--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#data-module-functions">Data Module Functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cryogrid_pytools.data.get_dem_copernicus30">get_dem_copernicus30</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.data.get_dem_copernicus30--parameters">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.data.get_dem_copernicus30--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cryogrid_pytools.data.get_esa_land_cover">get_esa_land_cover</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.data.get_esa_land_cover--parameters">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.data.get_esa_land_cover--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cryogrid_pytools.data.get_snow_melt_doy">get_snow_melt_doy</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.data.get_snow_melt_doy--parameters">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.data.get_snow_melt_doy--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cryogrid_pytools.data.get_randolph_glacier_inventory">get_randolph_glacier_inventory</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.data.get_randolph_glacier_inventory--parameters">Parameters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cryogrid_pytools.data.get_randolph_glacier_inventory--returns">Returns</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#utility-functions">Utility Functions</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CryoGrid-pyTools</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">API Reference</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/lukegre/CryoGrid-pyTools/edit/master/docs/api-reference.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="api-reference">API Reference</h1>
<p>This page contains the detailed API reference for CryoGrid-pyTools.</p>
<h2 id="main-functions">Main Functions</h2>


<div class="doc doc-object doc-function">


<h2 id="cryogrid_pytools.read_OUT_regridded_FCI2_file" class="doc doc-heading">
            <code class="highlight language-python">cryogrid_pytools.read_OUT_regridded_FCI2_file(fname, deepest_point=None)</code>

</h2>


    <div class="doc doc-contents first">

        <p>Read a CryoGrid OUT_regridded_FCI2 file and return it as an xarray dataset.</p>
<h4 id="cryogrid_pytools.read_OUT_regridded_FCI2_file--parameters">Parameters</h4>
<p>fname : str
    Path to the .mat file
deepest_point : float, optional
    Represents the deepest depth of the profile. If not provided, 
    then elevation is returned. Negative values represent depths below
    the surface.</p>
<h4 id="cryogrid_pytools.read_OUT_regridded_FCI2_file--returns">Returns</h4>
<p>ds : xarray.Dataset
    Dataset with dimensions 'time' and 'level'. The CryoGrid variable
    <code>depths</code> is renamed to <code>elevation</code>. If deepest_point is provided, then
    <code>depth</code> will represent the depth below the surface (negative below
    surface).</p>

            <details class="quote">
              <summary>Source code in <code>cryogrid_pytools/outputs.py</code></summary>
              <pre class="highlight"><code class="language-python">def read_OUT_regridded_FCI2_file(fname, deepest_point=None)-&gt;xr.Dataset:
    """
    Read a CryoGrid OUT_regridded_FCI2 file and return it as an xarray dataset.

    Parameters
    ----------
    fname : str
        Path to the .mat file
    deepest_point : float, optional
        Represents the deepest depth of the profile. If not provided, 
        then elevation is returned. Negative values represent depths below
        the surface.

    Returns
    -------
    ds : xarray.Dataset
        Dataset with dimensions 'time' and 'level'. The CryoGrid variable
        `depths` is renamed to `elevation`. If deepest_point is provided, then
        `depth` will represent the depth below the surface (negative below
        surface).
    """
    from .matlab_helpers import read_mat_struct_flat_as_dict, matlab2datetime

    dat = read_mat_struct_flat_as_dict(fname)
    for key in dat:
        dat[key] = dat[key].squeeze()

    ds = xr.Dataset()
    ds.attrs['filename'] = fname

    times = matlab2datetime(dat.pop('timestamp'))
    elevation = dat.pop('depths')

    for key in dat:
        ds[key] = xr.DataArray(
            data = dat[key].astype('float32'), 
            dims=['level', 'time'], 
            coords={'time': times})

    ds['elevation'] = xr.DataArray(elevation, dims=['level'])

    if deepest_point is not None:
        assert deepest_point &lt; 0, "deepest_point must be negative (below surface)"

        ds = ds.rename(level='depth')

        # calculate depth step size
        n = elevation.size - 1
        s = (elevation[-1] - elevation[0]) / n

        # calculate shallowest point based on step size and n
        shallowest_point = deepest_point - (s * n)
        deepest_point += s / 2  # adding half step for arange
        depth = np.arange(shallowest_point, deepest_point, s)
        ds['depth'] = xr.DataArray(depth, dims=['depth'])
        ds = ds.set_coords('depth')
        ds = ds.transpose('depth', 'time', ...)
    else:  
        ds = ds.transpose('elevation', 'time', ...)

    ds = ds.chunk(dict(time=-1))

    return ds</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cryogrid_pytools.read_OUT_regridded_FCI2_clusters" class="doc doc-heading">
            <code class="highlight language-python">cryogrid_pytools.read_OUT_regridded_FCI2_clusters(fname_glob, deepest_point, **joblib_kwargs)</code>

</h2>


    <div class="doc doc-contents first">

        <p>Reads multiple files that are put out by the OUT_regridded_FCI2 class</p>
<h4 id="cryogrid_pytools.read_OUT_regridded_FCI2_clusters--parameters">Parameters</h4>
<p>fname_glob: str
    Path of the files that you want to read in. 
    Use same notation as for glob(). Note that it expects
    name to follow the format <code>some_project_name_GRIDCELL_date.mat</code>
    where GRIDCELL will be extracted to assign the gridcell dimension. 
    These GRIDCELLs correspond with the index of the data in the 
    flattened array. 
deepest_point: float
    When setting the configuration for when the data should be 
    saved, the maximum depth is set. Give this number as a
    negative number here.
joblib_kwargs: dict
    Uses the joblib library to do parallel reading of the files. 
    Defaults are: n_jobs=-1, backend='threading', verbose=1</p>
<h4 id="cryogrid_pytools.read_OUT_regridded_FCI2_clusters--returns">Returns</h4>
<p>xr.Dataset
    An array with dimensions gridcell, depth, time. 
    Variables depend on how the class was configured, but
    elevation will also be a variable.</p>

            <details class="quote">
              <summary>Source code in <code>cryogrid_pytools/outputs.py</code></summary>
              <pre class="highlight"><code class="language-python">def read_OUT_regridded_FCI2_clusters(fname_glob, deepest_point, **joblib_kwargs):
    """
    Reads multiple files that are put out by the OUT_regridded_FCI2 class

    Parameters
    ----------
    fname_glob: str
        Path of the files that you want to read in. 
        Use same notation as for glob(). Note that it expects
        name to follow the format `some_project_name_GRIDCELL_date.mat`
        where GRIDCELL will be extracted to assign the gridcell dimension. 
        These GRIDCELLs correspond with the index of the data in the 
        flattened array. 
    deepest_point: float
        When setting the configuration for when the data should be 
        saved, the maximum depth is set. Give this number as a
        negative number here.
    joblib_kwargs: dict
        Uses the joblib library to do parallel reading of the files. 
        Defaults are: n_jobs=-1, backend='threading', verbose=1

    Returns
    -------
    xr.Dataset
        An array with dimensions gridcell, depth, time. 
        Variables depend on how the class was configured, but
        elevation will also be a variable. 
    """
    from glob import glob

    # get the file list
    flist = sorted(glob(fname_glob))
    # extract the gridcell from the file name
    gridcell = [int(f.split('_')[-2]) for f in flist]

    ds = read_OUT_regridded_FCI2_parallel(fname_glob, deepest_point, concat_dim='gridcell', **joblib_kwargs)
    ds['gridcell'] = xr.DataArray(gridcell, dims=['gridcell'])

    # transpose data so that plotting is quick and easy
    ds = ds.transpose('gridcell', 'depth', 'time', ...)

    return ds</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cryogrid_pytools.matlab_helpers.read_mat_struct_flat_as_dict" class="doc doc-heading">
            <code class="highlight language-python">cryogrid_pytools.matlab_helpers.read_mat_struct_flat_as_dict(fname, key=None)</code>

</h2>


    <div class="doc doc-contents first">

        <p>Read a MATLAB struct from a .mat file and return it as a dictionary.</p>
<p>Assumes that the struct is flat, i.e. it does not contain any nested
structs.</p>
<h4 id="cryogrid_pytools.matlab_helpers.read_mat_struct_flat_as_dict--parameters">Parameters</h4>
<p>fname : str
    Path to the .mat file
key : str, optional
    The name of the matlab key in the .mat file. If None is passed [default],
    then the first key that does not start with an underscore is used.
    If a string is passed, then the corresponding key is used.</p>
<h4 id="cryogrid_pytools.matlab_helpers.read_mat_struct_flat_as_dict--returns">Returns</h4>
<p>data : dict
    Dictionary with the struct fields as keys and the corresponding
    data as values.</p>

            <details class="quote">
              <summary>Source code in <code>cryogrid_pytools/matlab_helpers.py</code></summary>
              <pre class="highlight"><code class="language-python">def read_mat_struct_flat_as_dict(fname: str, key=None) -&gt; dict:
    """
    Read a MATLAB struct from a .mat file and return it as a dictionary.

    Assumes that the struct is flat, i.e. it does not contain any nested
    structs.

    Parameters
    ----------
    fname : str
        Path to the .mat file
    key : str, optional
        The name of the matlab key in the .mat file. If None is passed [default],
        then the first key that does not start with an underscore is used.
        If a string is passed, then the corresponding key is used.

    Returns
    -------
    data : dict
        Dictionary with the struct fields as keys and the corresponding
        data as values.
    """
    from scipy.io import loadmat

    raw = loadmat(fname)

    keys = [k for k in raw.keys() if not k.startswith('_')]

    if key is None:
        logger.log(5, f"No key specified. Using first key that does not start with an underscore: {keys[0]}")
        key = keys[0]
    elif key not in keys:
        raise ValueError(f"Key '{key}' not found in .mat file. Available keys are: {keys}")

    named_array = unnest_matlab_struct_named_array(raw[key])
    data = {k: named_array[k].squeeze() for k in named_array.dtype.names}

    return data</code></pre>
            </details>
    </div>

</div><h2 id="data-module-functions">Data Module Functions</h2>


<div class="doc doc-object doc-function">


<h2 id="cryogrid_pytools.data.get_dem_copernicus30" class="doc doc-heading">
            <code class="highlight language-python">cryogrid_pytools.data.get_dem_copernicus30(bbox_WSEN, res_m=30, epsg=32643, smoothing_iters=2, smoothing_size=3)</code>

</h2>


    <div class="doc doc-contents first">

        <p>Download DEM data from the STAC catalog (default is COP DEM Global 30m).</p>
<h4 id="cryogrid_pytools.data.get_dem_copernicus30--parameters">Parameters</h4>
<p>bbox_WSEN : list
    The bounding box of the area of interest in WSEN format.
res_m : int
    The resolution of the DEM data in meters.
epsg : int, optional
    The EPSG code of the projection of the DEM data. Default is 
    EPSG:32643 (UTM 43N) for the Pamir region. 
smoothing_iters : int, optional
    The number of iterations to apply the smoothing filter. Default is 2.
    Set to 0 to disable smoothing.
smoothing_size : int, optional
    The size of the kernel (num pixels) for the smoothing filter. Default is 3.</p>
<h4 id="cryogrid_pytools.data.get_dem_copernicus30--returns">Returns</h4>
<p>xarray.DataArray
    The DEM data as an xarray DataArray with attributes.</p>

            <details class="quote">
              <summary>Source code in <code>cryogrid_pytools/data.py</code></summary>
              <pre class="highlight"><code class="language-python">@_decorator_dataarray_to_bbox
def get_dem_copernicus30(bbox_WSEN:list, res_m:int=30, epsg=32643, smoothing_iters=2, smoothing_size=3)-&gt;_xr.DataArray:
    """
    Download DEM data from the STAC catalog (default is COP DEM Global 30m).

    Parameters
    ----------
    bbox_WSEN : list
        The bounding box of the area of interest in WSEN format.
    res_m : int
        The resolution of the DEM data in meters.
    epsg : int, optional
        The EPSG code of the projection of the DEM data. Default is 
        EPSG:32643 (UTM 43N) for the Pamir region. 
    smoothing_iters : int, optional
        The number of iterations to apply the smoothing filter. Default is 2.
        Set to 0 to disable smoothing.
    smoothing_size : int, optional
        The size of the kernel (num pixels) for the smoothing filter. Default is 3.

    Returns
    -------
    xarray.DataArray
        The DEM data as an xarray DataArray with attributes.
    """

    check_epsg(epsg)

    assert res_m &gt;= 30, "The resolution must be greater than 30m for the COP DEM Global 30m dataset."
    res = res_m / 111111 if epsg == 4326 else res_m

    _logger.info("Fetching COP DEM Global 30m data from Planetary Computer")
    items = search_stac_items_planetary_computer('cop-dem-glo-30', bbox_WSEN)
    da_dem = _stackstac.stack(
        items=items, 
        bounds_latlon=bbox_WSEN,
        resolution=res,
        epsg=epsg)

    da_dem = (
        da_dem
        .mean('time')
        .squeeze()
        .pipe(drop_coords_without_dim)
        .pipe(smooth_data, n_iters=smoothing_iters, kernel_size=smoothing_size)
        .rio.write_crs(f"EPSG:{epsg}")
        .assign_attrs(
            source=items[0].links[0].href,  # collection URL
            bbox_request=bbox_WSEN))

    return da_dem</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cryogrid_pytools.data.get_esa_land_cover" class="doc doc-heading">
            <code class="highlight language-python">cryogrid_pytools.data.get_esa_land_cover(bbox_WSEN, res_m=30, epsg=32643)</code>

</h2>


    <div class="doc doc-contents first">

        <p>Get the ESA World Cover dataset on the target grid and resolution.</p>
<h4 id="cryogrid_pytools.data.get_esa_land_cover--parameters">Parameters</h4>
<p>bbox_WSEN : tuple
    Bounding box in the format (West, South, East, North).
res_m : int, optional
    Resolution in meters. Defaults to 30.
epsg : int, optional
    EPSG code for the coordinate reference system. Defaults to 32643.</p>
<h4 id="cryogrid_pytools.data.get_esa_land_cover--returns">Returns</h4>
<p>xr.DataArray
    A DataArray with the land cover data on the target grid. Contains
    attributes 'class_values', 'class_descriptions', 'class_colors' for plotting.</p>

            <details class="quote">
              <summary>Source code in <code>cryogrid_pytools/data.py</code></summary>
              <pre class="highlight"><code class="language-python">@_decorator_dataarray_to_bbox
def get_esa_land_cover(bbox_WSEN:tuple, res_m:int=30, epsg=32643)-&gt;_xr.DataArray:
    """
    Get the ESA World Cover dataset on the target grid and resolution.

    Parameters
    ----------
    bbox_WSEN : tuple
        Bounding box in the format (West, South, East, North).
    res_m : int, optional
        Resolution in meters. Defaults to 30.
    epsg : int, optional
        EPSG code for the coordinate reference system. Defaults to 32643.

    Returns
    -------
    xr.DataArray
        A DataArray with the land cover data on the target grid. Contains
        attributes 'class_values', 'class_descriptions', 'class_colors' for plotting.
    """

    def get_land_cover_classes(item):
        """ 
        Get the land cover class names, and colors from the ESA World Cover dataset

        Args:
            item (pystac.Item): The STAC item containing the land cover data.

        Returns:
            dict: A dictionary with class values, descriptions, and colors.
        """
        import pandas as pd

        classes = item.assets['map'].extra_fields['classification:classes']
        df = pd.DataFrame(classes).set_index('value')

        df['color-hint'] = '#' + df['color-hint']

        out = dict(
            class_values = df.index.values,
            class_descriptions = df['description'].values,
            class_colors = df['color-hint'].values)

        return out

    # make sure epsg is supported
    check_epsg(epsg)

    # get the units in the projection
    res = get_res_in_proj_units(res_m, epsg, min_res=10)

    _logger.info("Fetching ESA World Cover (v2.0) data from Planetary Computer")
    items = search_stac_items_planetary_computer(
        collection='esa-worldcover', 
        bbox=bbox_WSEN, 
        query={'esa_worldcover:product_version': {'eq': '2.0.0'}})

    stac_props = dict(
        items=items, 
        assets=['map'],
        epsg=epsg,
        bounds_latlon=bbox_WSEN,
        resolution=res)

    da = (
        _stackstac.stack(**stac_props)
        .max(['band', 'time'], keep_attrs=True)  # removing the single band dimension
        .rename('land_cover')
        .assign_attrs(**get_land_cover_classes(items[0]))
    )

    return da</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cryogrid_pytools.data.get_snow_melt_doy" class="doc doc-heading">
            <code class="highlight language-python">cryogrid_pytools.data.get_snow_melt_doy(bbox_WSEN, years=range(2018, 2025), res_m=30, epsg=32643)</code>

</h2>


    <div class="doc doc-contents first">

        <p>Calculate the snow melt day of year (DOY) from Sentinel-2 SCL data for a given bounding box and years.</p>
<h4 id="cryogrid_pytools.data.get_snow_melt_doy--parameters">Parameters</h4>
<p>bbox_WSEN : tuple
    Bounding box coordinates in the format (West, South, East, North).
years : range, optional
    Range of years to consider. Defaults to range(2018, 2025).
res_m : int, optional
    Spatial resolution in meters. Defaults to 30.
epsg : int, optional
    EPSG code for the coordinate reference system. Defaults to 32643.</p>
<h4 id="cryogrid_pytools.data.get_snow_melt_doy--returns">Returns</h4>
<p>_xr.DataArray
    DataArray containing the snow melt DOY for each year.</p>

            <details class="quote">
              <summary>Source code in <code>cryogrid_pytools/data.py</code></summary>
              <pre class="highlight"><code class="language-python">@_decorator_dataarray_to_bbox
def get_snow_melt_doy(bbox_WSEN:tuple, years=range(2018, 2025), res_m:int=30, epsg=32643)-&gt;_xr.DataArray:
    """
    Calculate the snow melt day of year (DOY) from Sentinel-2 SCL data for a given bounding box and years.

    Parameters
    ----------
    bbox_WSEN : tuple
        Bounding box coordinates in the format (West, South, East, North).
    years : range, optional
        Range of years to consider. Defaults to range(2018, 2025).
    res_m : int, optional
        Spatial resolution in meters. Defaults to 30.
    epsg : int, optional
        EPSG code for the coordinate reference system. Defaults to 32643.

    Returns
    -------
    _xr.DataArray
        DataArray containing the snow melt DOY for each year.
    """

    da = get_sentinel2_data(bbox_WSEN, years=years, res_m=res_m, epsg=epsg, max_cloud_cover=10)

    _logger.info("Calculating snow melt day of year (DOY) from Sentinel-2 SCL data")
    doy = da.groupby('time.year').apply(calc_sentinel2_snow_melt_doy)

    return doy</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cryogrid_pytools.data.get_randolph_glacier_inventory" class="doc doc-heading">
            <code class="highlight language-python">cryogrid_pytools.data.get_randolph_glacier_inventory(target_dem=None, dest_dir=None)</code>

</h2>


    <div class="doc doc-contents first">

        <p>Fetches the Randolph Glacier Inventory (RGI) data and returns it as a GeoDataFrame or raster dataset.</p>
<h4 id="cryogrid_pytools.data.get_randolph_glacier_inventory--parameters">Parameters</h4>
<p>target_dem : optional
    A digital elevation model (DEM) object. If provided, the function will return 
    the RGI data clipped to the bounding box of the DEM and reprojected to the DEM's CRS.
dest_dir : str, optional
    The directory where the downloaded RGI data will be stored. If None, the data will
    be stored in the pooch cache directory (~/.cache/pooch/).</p>
<h4 id="cryogrid_pytools.data.get_randolph_glacier_inventory--returns">Returns</h4>
<p>GeoDataFrame or raster dataset
    If target_dem is None, returns a GeoDataFrame containing the RGI data.
    If target_dem is provided, returns a raster dataset clipped and reprojected to the DEM.</p>

            <details class="quote">
              <summary>Source code in <code>cryogrid_pytools/data.py</code></summary>
              <pre class="highlight"><code class="language-python">@_cached
def get_randolph_glacier_inventory(target_dem=None, dest_dir=None):
    """
    Fetches the Randolph Glacier Inventory (RGI) data and returns it as a GeoDataFrame or raster dataset.

    Parameters
    ----------
    target_dem : optional
        A digital elevation model (DEM) object. If provided, the function will return 
        the RGI data clipped to the bounding box of the DEM and reprojected to the DEM's CRS.
    dest_dir : str, optional
        The directory where the downloaded RGI data will be stored. If None, the data will
        be stored in the pooch cache directory (~/.cache/pooch/).

    Returns
    -------
    GeoDataFrame or raster dataset
        If target_dem is None, returns a GeoDataFrame containing the RGI data.
        If target_dem is provided, returns a raster dataset clipped and reprojected to the DEM.
    """

    url = 'https://daacdata.apps.nsidc.org/pub/DATASETS/nsidc0770_rgi_v7/regional_files/RGI2000-v7.0-G/RGI2000-v7.0-G-13_central_asia.zip'

    downloader = _pooch.HTTPDownloader(progressbar=True, headers=get_earthaccess_session().headers)
    flist = download_url(url, path=dest_dir, downloader=downloader)

    fname_shp = [f for f in flist if f.endswith('.shp')][0]

    _logger.log("INFO", f"RGI: Fetching Randolph Glacier Inventory - see https://www.glims.org/rgi_user_guide/welcome.html")
    _logger.log("DEBUG", f"RGI: URL = {url}")
    _logger.log("DEBUG", f"RGI: FILE = {fname_shp}")

    if target_dem is None:
        # reads the whole file
        df = _gpd.read_file(fname_shp)
    else:
        # gets the bounding box and then reads the file
        bbox = target_dem.rv.get_bbox_latlon()
        df = _gpd.read_file(fname_shp, bbox=bbox).to_crs(target_dem.rio.crs)
        df = df.dissolve()
        ds = df.rv.to_raster(target_dem)
        return ds

    return df</code></pre>
            </details>
    </div>

</div><h2 id="utility-functions">Utility Functions</h2>
<p>Additional utility functions are available in the package. See the source code documentation for more details.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../usage/spatial-data/" class="btn btn-neutral float-left" title="Spatial Data and Forcing"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/lukegre/CryoGrid-pyTools" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../usage/spatial-data/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
